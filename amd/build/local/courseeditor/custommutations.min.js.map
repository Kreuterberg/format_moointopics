{"version":3,"file":"custommutations.min.js","sources":["../../../src/local/courseeditor/custommutations.js"],"sourcesContent":["import ajax from 'core/ajax';\n\nexport default class {\n    \n\n    async completeSection(stateManager, target) {\n        const course = stateManager.get('course');\n        let ids = [];\n        ids.push(target.dataset.id);\n        const args = {\n            action: 'complete_section',\n            courseid: course.id,\n            ids: ids,\n            targetsectionid: target.dataset.id,\n        };\n        let updates = await ajax.call([{\n            methodname: 'core_courseformat_update_course',\n            args,\n        }])[0];\n        stateManager.processUpdates(JSON.parse(updates));\n    }\n\n    async updateSectionprogress(stateManager, sectionId) {\n        const course = stateManager.get('course');\n        let ids = [];\n        ids.push(sectionId);\n        const args = {\n            action: 'update_sectionprogress',\n            courseid: course.id,\n            ids: ids,\n            targetsectionid: sectionId,\n        };\n        let updates = await ajax.call([{\n            methodname: 'core_courseformat_update_course',\n            args,\n        }])[0];\n        stateManager.processUpdates(JSON.parse(updates));\n    }\n\n    async sectionSetChapter(stateManager, target) {\n        const course = stateManager.get('course');\n        let ids = [];\n        const targetSection = stateManager.state.section.get(target.dataset.id);\n        ids.push(target.dataset.id);\n        // stateManager.state.section.forEach(section => {\n        //     if (section.number >= targetSection.number) {\n        //         ids.push(section.id);\n        //     }\n        // });\n        \n        \n        const args = {\n            action: 'section_setChapter',\n            courseid: course.id,\n            ids: ids,\n            targetsectionid: target.dataset.id,\n        };\n        let updates = await ajax.call([{\n            methodname: 'core_courseformat_update_course',\n            args,\n        }])[0];\n        stateManager.processUpdates(JSON.parse(updates));\n        stateManager.setReadOnly(false);\n\n        let lastChapter = stateManager.state.section.get(target.dataset.id);\n        let invisbleCounter = 0\n\n        stateManager.state.section.forEach(section => {\n            if (section.number > targetSection.number) {\n                //statesection = state.section.get(section.id)\n                if (section.isChapter) {\n                    lastChapter = section;  // Das aktuelle Chapter zwischenspeichern\n                    section.isChapter++;\n                    invisbleCounter = 0\n                } else if (section.isChapter == false) {\n                    \n                        section.parentChapter = lastChapter.isChapter;\n                        section.innerChapterNumber = section.number - lastChapter.number - invisbleCounter;\n                        if (section.visible) {\n                            section.prefix = section.parentChapter + \".\" + section.innerChapterNumber;\n                        } else {\n                            invisbleCounter++\n                        }\n                        \n                        \n                    \n                }\n            }\n        });\n        stateManager.setReadOnly(true);\n        \n    }\n    async sectionUnsetChapter(stateManager, target) {\n        const course = stateManager.get('course');\n        let ids = [];\n        const targetSection = stateManager.state.section.get(target.dataset.id);\n        ids.push(target.dataset.id);\n        // const targetSection = stateManager.state.section.get(target.dataset.id);\n        // stateManager.state.section.forEach(section => {\n        //     if (section.number >= targetSection.number) {\n        //         ids.push(section.id);\n        //     }\n        // });\n        \n        const args = {\n            action: 'section_unsetChapter',\n            courseid: course.id,\n            ids: ids,\n            targetsectionid: target.dataset.id,\n        };\n        let updates = await ajax.call([{\n            methodname: 'core_courseformat_update_course',\n            args,\n        }])[0];\n        \n\n        stateManager.setReadOnly(false);\n\n        let lastChapter = stateManager.state.section.get(target.dataset.id);\n        let prevChapter = lastChapter.isChapter -1;\n\n        stateManager.state.section.forEach(section => {\n            window.console.log(prevChapter);\n            window.console.log(section.isChapter);\n            if (section.isChapter == prevChapter) {\n                lastChapter = section;\n            }\n        });\n\n        let invisbleCounter = 0\n\n        stateManager.state.section.forEach(section => {\n            if (section.number > targetSection.number) {\n                //statesection = state.section.get(section.id)\n                if (section.isChapter && section.isChapter != 1) {\n                    lastChapter = section;\n                    section.isChapter--;\n                    invisbleCounter = 0\n                } else if (section.isChapter == false) {\n                    \n                        section.parentChapter = lastChapter.isChapter;\n                        section.innerChapterNumber = section.number - lastChapter.number - invisbleCounter;\n                        if (section.visible) {\n                            section.prefix = section.parentChapter + \".\" + section.innerChapterNumber;\n                        } else {\n                            invisbleCounter++\n                        } \n                }\n            }\n        });\n        stateManager.setReadOnly(true);\n        stateManager.processUpdates(JSON.parse(updates));\n        \n    }\n\n    async setLastSectionModal(stateManager, id) {\n        const course = stateManager.get('course');\n        let ids = [];\n        ids.push(id);\n        const args = {\n            action: 'set_last_section_modal',\n            courseid: course.id,\n            ids: ids,\n            targetsectionid: id,\n        };\n        let updates = await ajax.call([{\n            methodname: 'core_courseformat_update_course',\n            args,\n        }])[0];\n        stateManager.processUpdates(JSON.parse(updates));\n    }\n\n    setContinueSection(stateManager, type, id) {\n        stateManager.setReadOnly(false);\n        const state = stateManager.state;\n        const course = state.course;\n        course.continueSection = id;\n        state.section.forEach((section) => {\n            //section.containsActiveSection = false;\n            //section.isActiveSection = false;\n            if (section.id == id) {\n                section.isActiveSection = true;\n            }\n            \n            if (section.parentChapter == state.section.get(id).parentChapter) {\n                section.containsActiveSection = true;\n                \n            }\n        });\n        state.section.get(id).isActiveSection = true;\n        \n        stateManager.setReadOnly(true);\n    }\n\n    async getContinueSection(stateManager, target) {\n        const state = stateManager.state;\n        const course = state.course;\n        const args = {\n            action: 'getContinuesection',\n            courseid: course.id,\n        };\n        let updates = await ajax.call([{\n            methodname: 'core_courseformat_update_course',\n            args,\n        }])[0];\n        stateManager.processUpdates(JSON.parse(updates));\n    }\n\n    async readAllForumDiscussions(stateManager, forumid) {\n        const state = stateManager.state;\n        const course = state.course;\n        let ids = [];\n        ids.push(forumid);\n        const args = {\n            action: 'readAllForumDiscussions',\n            courseid: course.id,\n            ids: ids,\n        }\n        let updates = await ajax.call([{\n            methodname: 'core_courseformat_update_course',\n            args,\n        }])[0];\n        stateManager.processUpdates(JSON.parse(updates));\n    }\n\n    async reloadAllSectionPrefixes(stateManager, target) {\n        const state = stateManager.state;\n        const course = state.course;\n        let ids = [];\n        stateManager.state.section.forEach(section => {\n            // if (section.number >= target.number) {\n                ids.push(section.id);\n            // }\n        });\n        //ids.push(target); \n        const args = {\n            action: 'reload_all_section_prefixes',\n            courseid: course.id,\n            ids: ids,\n        }\n        let updates = await ajax.call([{\n            methodname: 'core_courseformat_update_course',\n            args,\n        }])[0];\n        stateManager.processUpdates(JSON.parse(updates));\n    }\n}"],"names":["stateManager","target","course","get","ids","push","dataset","id","args","action","courseid","targetsectionid","updates","ajax","call","methodname","processUpdates","JSON","parse","sectionId","targetSection","state","section","setReadOnly","lastChapter","invisbleCounter","forEach","number","isChapter","parentChapter","innerChapterNumber","visible","prefix","prevChapter","window","console","log","setContinueSection","type","continueSection","isActiveSection","containsActiveSection","forumid"],"mappings":"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"}